{% extends "base.html" %}{% load html_text from html_utils %}

{% block pagetitle %}
The Database | {{ block.super }}
{% endblock %}


{% block bodyclass %}database{% endblock %}

{% block content-shell %}
<section class='poster'>
    <header>
        <h1>The Database</h1>
    </header>
</section>
<section role="search" class="search">
    <form action="{% url 'search:search' %}">
        <span class="custom-dropdown">
            <select name="facet">
                {# FIXME: Generate menu dynamically using info from search facet #}
                <option selected disabled>Categories</option>
                <option disabled>----------</option>
                <option value="_category:Project">Projects</option>
                <option value="_category:Organization">Organizations</option>
                <option value="_category:Initiative">Initiatives</option>
                <option value="_category:Event">Events</option>
                <option value="_category:Person">People</option>
            </select>
        </span>
        <div class="search-bar">
            <input type="text" class="primary" name="q" value="" placeholder="Search the database">
            <button type="submit">Search</button>
            <button type="reset">Clear</button>
        </div>
    </form>
</section>
{% if featured_items %}
<section class="featured columnar">
    <header>
        <h2>Featured Entries</h2>
    </header>
    <div class="wrap content-wrap">
        {% for item in featured_items.items.all %}{% with item.content_object as object %}
        <section class="panel {{item.content_type}}{% if object.infrastructure_type %} {{object.infrastructure_type.slug}}{% endif %}">
            <div class="inner">
                <h3><a href="{{object.get_absolute_url}}">{% if object.name %}{{object.name}}{% else %}{{object.title}}{% endif %}</a></h3>
                {% if item.description_rendered %}
                {{item.description_rendered|html_text|truncatewords_html:30|safe}}
                {% else %}
                {{object.description_rendered|html_text|truncatewords_html:30|safe}}
                {% endif %}
                <footer>
                    <p><a href="{{object.get_absolute_url}}">Read More</a></p>
                </footer>
            </div>
        </section>
        {% endwith %}
        {% empty %}
        <!-- No featured_items?!? -->
        {% endfor %}
    </div>
</section>
{% endif %}
<nav role="navigation">
    <ul>
        <li><a class="button gem" href="{% url 'glossary' %}">Glossary</a></li>
        <li><a class="button gem" href="{% url 'methodology' %}">Methodology</a></li>
    </ul>
</nav>
<section class="wrap content-wrap browse">
    <h2>Browse the Database</h2>
    <div class="row">
        <section>
            <h3><a href="{% url 'infrastructure:project-list' %}">Projects</a></h3>
            <ul class="clean details">
                {% for infra_type in infrastructure_types %}
                <li>{{infra_type.name}}</li>{% endfor %}
            </ul>
        </section>
        <section>
            <h3><a href="{% url 'infrastructure:initiative-list' %}">Initiatives</a></h3>
        </section>
        <section>
            <h3><a href="{% url 'facts:organization-list' %}">Organizations</a></h3>
            <ul class="clean details">
                {% for modelname, label in organization_types %}
                <li><a href="{% url 'facts:organization-list-redirect' org_type=modelname %}">{{label}}</a></li>{% endfor %}
            </ul>
        </section>
        <section>
            <h3><a href="{% url 'facts:event-list' %}">Events</a></h3>
        </section>
        <section>
            <h3><a href="{% url 'facts:person-list' %}">People</a></h3>
        </section>
    </div>
</section>
{% endblock %}
